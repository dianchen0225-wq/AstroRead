import { themeManager, ThemeMode } from '../common/ThemeManager';
import { DesignSystem } from '../common/DesignSystem';
import { NavigationManager } from '../common/NavigationManager';
import { AppNavBar, SectionHeader } from '../components/AppNavigation';
import { viewModelManager } from '../viewmodel/ViewModelManager';
import { ReadConfig } from '../models/ReadConfig';
import { ReadConfigViewModel } from '../viewmodel/ReadConfigViewModel';
import { Logger } from '../utils/Logger';
import { showToast } from '../utils/ToastUtils';
import { floatingNavManager, FloatingNavConfig, FloatingNavPosition } from '../common/FloatingNavManager';
import display from '@ohos.display';

// è®¾ç½®å­˜å‚¨é”®
const SETTINGS_STORAGE_KEY = 'app_settings';

// åº”ç”¨è®¾ç½®æ¥å£
interface AppSettings {
  autoUpdate: boolean;
  cacheSize: string;
  readBackground: string;
}

interface SettingItem {
  id: string;
  title: string;
  subtitle?: string;
  icon: string;
  type: 'navigation' | 'toggle' | 'slider' | 'action' | 'info';
  value?: string | number | boolean;
  route?: string;
  action?: () => void;
}

interface SettingGroup {
  id: string;
  title: string;
  items: SettingItem[];
}

interface PositionOption {
  id: string;
  label: string;
  icon: string;
}

@ComponentV2
export struct SettingsPage {
  @Local isLightMode: boolean = true;
  @Local fontSize: number = 16;
  @Local lineSpacing: number = 1.6;
  @Local cacheSize: string = '128MB';
  @Local autoUpdate: boolean = true;
  @Local themeModeIndex: number = 0;
  @Local readConfig: ReadConfig = ReadConfigViewModel.DEFAULT_READ_CONFIG;
  @Local showClearCacheConfirm: boolean = false;
  @Local isClearingCache: boolean = false;
  @Local showAboutSheet: boolean = false;
  @Local searchKeyword: string = '';
  @Local filteredGroups: SettingGroup[] = [];
  @Local floatingNavConfig: FloatingNavConfig = floatingNavManager.getConfig();
  @Local showFloatingNavSettings: boolean = false;
  @Local showThemeModeSheet: boolean = false;
  @Local showReadBackgroundSheet: boolean = false;
  @Local showFeedbackSheet: boolean = false;
  @Local screenWidth: number = 360;
  @Local screenHeight: number = 780;
  @Local isTablet: boolean = false;
  @Param safeAreaTop: number = 0;
  @Param safeAreaBottom: number = 0;
  
  private settingGroups: SettingGroup[] = [];
  private themeListener: (isDark: boolean) => void = (isDark: boolean) => {
    this.isLightMode = !isDark;
  };
  private floatingNavListener: (config: FloatingNavConfig) => void = (config: FloatingNavConfig) => {
    this.floatingNavConfig = config;
    this.initSettingGroups();
    this.performSearch(this.searchKeyword);
  };

  aboutToAppear(): void {
    // Component initialized
    this.isLightMode = themeManager.isLightTheme();
    this.themeModeIndex = this.getThemeModeIndex();
    themeManager.addListener(this.themeListener);
    floatingNavManager.addConfigChangeListener(this.floatingNavListener);
    
    this.updateScreenSize();
    this.loadSettings();
    this.loadReadConfig();
    this.initSettingGroups();
    this.filteredGroups = this.settingGroups.slice();
  }

  // æ›´æ–°å±å¹•å°ºå¯¸å’Œå“åº”å¼çŠ¶æ€
  private updateScreenSize(): void {
    try {
      const displayInfo = display.getDefaultDisplaySync();
      this.screenWidth = displayInfo.width;
      this.screenHeight = displayInfo.height;
      // å¹³æ¿åˆ¤æ–­ï¼šå®½åº¦å¤§äº600vpè®¤ä¸ºæ˜¯å¹³æ¿
      this.isTablet = this.screenWidth > 600;
      Logger.info('SettingsPage', `å±å¹•å°ºå¯¸: ${this.screenWidth}x${this.screenHeight}, æ˜¯å¦å¹³æ¿: ${this.isTablet}`);
    } catch (error) {
      Logger.error('SettingsPage', `è·å–å±å¹•å°ºå¯¸å¤±è´¥: ${error}`);
    }
  }

  // è·å–å“åº”å¼å†…å®¹å®½åº¦
  private getContentWidth(): string {
    if (this.isTablet) {
      return '70%';
    }
    return '100%';
  }

  // è·å–å“åº”å¼æœ€å¤§å†…å®¹å®½åº¦
  private getMaxContentWidth(): number {
    if (this.isTablet) {
      return 600;
    }
    return Infinity;
  }

  aboutToDisappear(): void {
    // Component destroyed
    themeManager.removeListener(this.themeListener);
    floatingNavManager.removeConfigChangeListener(this.floatingNavListener);
  }

  private getThemeModeIndex(): number {
    const mode = themeManager.getThemeMode();
    switch (mode) {
      case ThemeMode.LIGHT:
        return 0;
      case ThemeMode.DARK:
        return 1;
      case ThemeMode.AUTO:
        return 2;
      default:
        return 0;
    }
  }

  private async loadReadConfig(): Promise<void> {
    try {
      const readConfigViewModel = viewModelManager.getReadConfigViewModel();
      this.readConfig = await readConfigViewModel.getReadConfig();
      this.fontSize = this.readConfig.fontSize;
      this.lineSpacing = this.readConfig.lineSpacing;
    } catch (error) {
      Logger.error('SettingsPage', `åŠ è½½é˜…è¯»é…ç½®å¤±è´¥: ${error}`);
    }
  }

  // åŠ è½½åº”ç”¨è®¾ç½®
  private loadSettings(): void {
    try {
      const settingsStr = AppStorage.get<string>(SETTINGS_STORAGE_KEY);
      if (settingsStr) {
        const settings: AppSettings = JSON.parse(settingsStr);
        this.autoUpdate = settings.autoUpdate !== undefined ? settings.autoUpdate : true;
        this.cacheSize = settings.cacheSize || '128MB';
        Logger.info('SettingsPage', 'è®¾ç½®åŠ è½½æˆåŠŸ');
      }
    } catch (error) {
      Logger.error('SettingsPage', `åŠ è½½è®¾ç½®å¤±è´¥: ${error}`);
    }
  }

  // ä¿å­˜åº”ç”¨è®¾ç½®
  private saveSettings(): void {
    try {
      const settings: AppSettings = {
        autoUpdate: this.autoUpdate,
        cacheSize: this.cacheSize,
        readBackground: 'é»˜è®¤'
      };
      AppStorage.set(SETTINGS_STORAGE_KEY, JSON.stringify(settings));
      Logger.info('SettingsPage', 'è®¾ç½®ä¿å­˜æˆåŠŸ');
    } catch (error) {
      Logger.error('SettingsPage', `ä¿å­˜è®¾ç½®å¤±è´¥: ${error}`);
    }
  }

  private initSettingGroups(): void {
    this.settingGroups = [
      {
        id: 'appearance',
        title: 'å¤–è§‚è®¾ç½®',
        items: [
          {
            id: 'theme_mode',
            title: 'ä¸»é¢˜æ¨¡å¼',
            subtitle: this.getThemeModeText(),
            icon: 'ğŸ¨',
            type: 'navigation',
            route: 'ThemeModeSheet'
          }
        ]
      },
      {
        id: 'reading',
        title: 'é˜…è¯»è®¾ç½®',
        items: [
          {
            id: 'font_size',
            title: 'å­—ä½“å¤§å°',
            subtitle: `${this.fontSize}px`,
            icon: 'ğŸ”¤',
            type: 'slider',
            value: this.fontSize
          },
          {
            id: 'line_spacing',
            title: 'è¡Œé—´è·',
            subtitle: `${this.lineSpacing.toFixed(1)}`,
            icon: 'ğŸ“',
            type: 'slider',
            value: this.lineSpacing
          },
          {
            id: 'read_background',
            title: 'é˜…è¯»èƒŒæ™¯',
            subtitle: 'é»˜è®¤',
            icon: 'ğŸ–¼ï¸',
            type: 'navigation',
            route: 'ReadBackgroundSheet'
          }
        ]
      },
      {
        id: 'app',
        title: 'åº”ç”¨è®¾ç½®',
        items: [
          {
            id: 'auto_update',
            title: 'è‡ªåŠ¨æ›´æ–°',
            subtitle: 'è‡ªåŠ¨æ£€æŸ¥ä¹¦æºæ›´æ–°',
            icon: 'ğŸ”„',
            type: 'toggle',
            value: this.autoUpdate
          },
          {
            id: 'floating_nav',
            title: 'æ‚¬æµ®å¯¼èˆªæ ',
            subtitle: this.floatingNavConfig.enabled ? 'å·²å¼€å¯' : 'å·²å…³é—­',
            icon: 'ğŸ§­',
            type: 'navigation',
            route: 'FloatingNavSettings'
          },
          {
            id: 'cache',
            title: 'æ¸…é™¤ç¼“å­˜',
            subtitle: this.cacheSize,
            icon: 'ğŸ—‘ï¸',
            type: 'action',
            action: () => {
              this.showClearCacheConfirm = true;
            }
          }
        ]
      },
      {
        id: 'developer',
        title: 'å¼€å‘è€…é€‰é¡¹',
        items: [
          {
            id: 'debug_log',
            title: 'è°ƒè¯•æ—¥å¿—',
            subtitle: 'æŸ¥çœ‹åº”ç”¨è¿è¡Œæ—¥å¿—',
            icon: 'ğŸ“‹',
            type: 'navigation',
            route: 'DebugLogPage'
          },
          {
            id: 'performance',
            title: 'æ€§èƒ½ç›‘æ§',
            subtitle: 'æŸ¥çœ‹åº”ç”¨æ€§èƒ½æ•°æ®',
            icon: 'ğŸ“Š',
            type: 'navigation',
            route: 'PerformanceMonitorPage'
          },
          {
            id: 'book_source_repair',
            title: 'ä¹¦æºè¯Šæ–­ä¿®å¤',
            subtitle: 'è¯Šæ–­å¹¶ä¿®å¤ä¹¦æºè®¿é—®é—®é¢˜',
            icon: 'ğŸ”§',
            type: 'navigation',
            route: 'BookSourceRepairPage'
          }
        ]
      },
      {
        id: 'about',
        title: 'å…³äº',
        items: [
          {
            id: 'about_app',
            title: 'å…³äºåº”ç”¨',
            subtitle: 'ç‰ˆæœ¬ 1.0.0',
            icon: 'â„¹ï¸',
            type: 'navigation',
            route: 'AboutSheet'
          },
          {
            id: 'feedback',
            title: 'æ„è§åé¦ˆ',
            subtitle: 'å¸®åŠ©æˆ‘ä»¬æ”¹è¿›',
            icon: 'ğŸ’¬',
            type: 'navigation',
            route: 'FeedbackSheet'
          }
        ]
      }
    ];
  }

  private getThemeModeText(): string {
    switch (this.themeModeIndex) {
      case 0:
        return 'æµ…è‰²æ¨¡å¼';
      case 1:
        return 'æ·±è‰²æ¨¡å¼';
      case 2:
        return 'è·Ÿéšç³»ç»Ÿ';
      default:
        return 'æµ…è‰²æ¨¡å¼';
    }
  }

  private performSearch(keyword: string): void {
    this.searchKeyword = keyword;
    
    if (!keyword || keyword.trim().length === 0) {
      this.filteredGroups = this.settingGroups.slice();
      return;
    }
    
    const lowerKeyword = keyword.toLowerCase().trim();
    const filtered: SettingGroup[] = [];
    
    for (const group of this.settingGroups) {
      const matchedItems = group.items.filter(item => 
        item.title.toLowerCase().includes(lowerKeyword) ||
        (item.subtitle && item.subtitle.toLowerCase().includes(lowerKeyword))
      );
      
      if (matchedItems.length > 0) {
        filtered.push({
          id: group.id,
          title: group.title,
          items: matchedItems
        });
      }
    }
    
    this.filteredGroups = filtered;
  }

  private async toggleAutoUpdate(): Promise<void> {
    this.autoUpdate = !this.autoUpdate;
    this.saveSettings();
    this.initSettingGroups();
    showToast({
      message: this.autoUpdate ? 'å·²å¼€å¯è‡ªåŠ¨æ›´æ–°' : 'å·²å…³é—­è‡ªåŠ¨æ›´æ–°'
    });
  }

  private async clearCache(): Promise<void> {
    this.isClearingCache = true;
    
    try {
      // æ¨¡æ‹Ÿæ¸…é™¤ç¼“å­˜æ“ä½œ
      await new Promise<void>(resolve => setTimeout(resolve, 1000));
      this.cacheSize = '0MB';
      this.saveSettings();
      this.initSettingGroups();
      showToast({
        message: 'ç¼“å­˜å·²æ¸…é™¤'
      });
    } catch (error) {
      Logger.error('SettingsPage', `æ¸…é™¤ç¼“å­˜å¤±è´¥: ${error}`);
      showToast({
        message: 'æ¸…é™¤å¤±è´¥'
      });
    } finally {
      this.isClearingCache = false;
      this.showClearCacheConfirm = false;
    }
  }

  private async updateFontSize(size: number): Promise<void> {
    this.fontSize = Math.round(size);
    this.readConfig.fontSize = this.fontSize;
    
    try {
      const readConfigViewModel = viewModelManager.getReadConfigViewModel();
      await readConfigViewModel.updateReadConfig(this.readConfig);
    } catch (error) {
      Logger.error('SettingsPage', `ä¿å­˜å­—ä½“å¤§å°å¤±è´¥: ${error}`);
    }
  }

  private async updateLineSpacing(spacing: number): Promise<void> {
    this.lineSpacing = Math.round(spacing * 10) / 10;
    this.readConfig.lineSpacing = this.lineSpacing;
    
    try {
      const readConfigViewModel = viewModelManager.getReadConfigViewModel();
      await readConfigViewModel.updateReadConfig(this.readConfig);
    } catch (error) {
      Logger.error('SettingsPage', `ä¿å­˜è¡Œé—´è·å¤±è´¥: ${error}`);
    }
  }

  private async setThemeMode(index: number): Promise<void> {
    this.themeModeIndex = index;
    const modes: ThemeMode[] = [ThemeMode.LIGHT, ThemeMode.DARK, ThemeMode.AUTO];
    await themeManager.setThemeMode(modes[index]);
    
    this.initSettingGroups();
    this.performSearch(this.searchKeyword);
  }

  private handleItemAction(item: SettingItem): void {
    if (item.type === 'navigation' && item.route) {
      if (item.route === 'DebugLogPage') {
        NavigationManager.getInstance().navigateTo('DebugLogPage');
      } else if (item.route === 'PerformanceMonitorPage') {
        NavigationManager.getInstance().navigateTo('PerformanceMonitorPage');
      } else if (item.route === 'BookSourceRepairPage') {
        NavigationManager.getInstance().navigateTo('BookSourceRepairPage');
      } else if (item.route === 'AboutSheet') {
        this.showAboutSheet = true;
      } else if (item.route === 'FloatingNavSettings') {
        this.showFloatingNavSettings = true;
      } else if (item.route === 'ThemeModeSheet') {
        this.showThemeModeSheet = true;
      } else if (item.route === 'ReadBackgroundSheet') {
        this.showReadBackgroundSheet = true;
      } else if (item.route === 'FeedbackSheet') {
        this.showFeedbackSheet = true;
      }
    } else if (item.type === 'action' && item.action) {
      item.action();
    } else if (item.type === 'toggle' && item.id === 'auto_update') {
      this.toggleAutoUpdate();
    }
  }

  build() {
    Stack() {
      Column() {
        AppNavBar({
          title: $r('app.string.settings'),
          showBack: true,
          safeAreaTop: this.safeAreaTop
        })

        this.buildSearchBar()

        Scroll() {
          Column() {
            ForEach(this.filteredGroups, (group: SettingGroup) => {
              this.buildSettingGroup(group)
            })

            if (this.filteredGroups.length === 0) {
              this.buildEmptySearchResult()
            }
          }
          .width(this.getContentWidth())
          .padding({ bottom: DesignSystem.Spacing.xxl + this.safeAreaBottom })
        }
        .width('100%')
        .constraintSize({ maxWidth: this.getMaxContentWidth() })
        .layoutWeight(1)
        .scrollBar(BarState.Auto)
      }
      .width('100%')
      .height('100%')
      .backgroundColor(DesignSystem.getPrimaryBackgroundColor(this.isLightMode))
      .alignItems(this.isTablet ? HorizontalAlign.Center : HorizontalAlign.Start)
    }
    .width('100%')
    .height('100%')
    .onAreaChange((oldArea: Area, newArea: Area) => {
      // ç›‘å¬åŒºåŸŸå˜åŒ–ï¼Œæ›´æ–°å±å¹•å°ºå¯¸
      if (newArea.width !== oldArea.width || newArea.height !== oldArea.height) {
        this.updateScreenSize();
      }
    })
    .bindSheet($$this.showClearCacheConfirm, this.buildClearCacheSheet(), {
      height: 'auto',
      backgroundColor: Color.Transparent,
      dragBar: false
    })
    .bindSheet($$this.showAboutSheet, this.buildAboutSheet(), {
      height: 'auto',
      backgroundColor: Color.Transparent,
      dragBar: false
    })
    .bindSheet($$this.showFloatingNavSettings, this.buildFloatingNavSettingsSheet(), {
      height: '90%',
      backgroundColor: Color.Transparent,
      dragBar: true
    })
    .bindSheet($$this.showThemeModeSheet, this.buildThemeModeSheet(), {
      height: 'auto',
      backgroundColor: Color.Transparent,
      dragBar: false
    })
    .bindSheet($$this.showReadBackgroundSheet, this.buildReadBackgroundSheet(), {
      height: 'auto',
      backgroundColor: Color.Transparent,
      dragBar: false
    })
    .bindSheet($$this.showFeedbackSheet, this.buildFeedbackSheet(), {
      height: 'auto',
      backgroundColor: Color.Transparent,
      dragBar: false
    })
  }

  @Builder
  buildSearchBar() {
    Row() {
      Text('ğŸ”')
        .fontSize(DesignSystem.IconSize.sm)
        .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
        .margin({ right: DesignSystem.Spacing.sm })

      TextInput({ placeholder: 'æœç´¢è®¾ç½®é¡¹...', text: this.searchKeyword })
        .layoutWeight(1)
        .backgroundColor(Color.Transparent)
        .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
        .fontSize(DesignSystem.Typography.size.sm)
        .placeholderColor(DesignSystem.getTertiaryTextColor(this.isLightMode))
        .onChange((value: string) => {
          this.performSearch(value);
        })

      if (this.searchKeyword.length > 0) {
        Text('âœ•')
          .fontSize(DesignSystem.IconSize.sm)
          .fontColor(DesignSystem.getTertiaryTextColor(this.isLightMode))
          .onClick(() => {
            this.performSearch('');
          })
      }
    }
    .width('100%')
    .padding(DesignSystem.Spacing.md)
    .margin({
      left: DesignSystem.Spacing.lg,
      right: DesignSystem.Spacing.lg,
      top: DesignSystem.Spacing.sm,
      bottom: DesignSystem.Spacing.md
    })
    .borderRadius(DesignSystem.BorderRadius.lg)
    .backgroundColor(DesignSystem.getSecondaryBackgroundColor(this.isLightMode))
  }

  @Builder
  buildSettingGroup(group: SettingGroup) {
    Column() {
      SectionHeader({ title: group.title })

      Column() {
        ForEach(group.items, (item: SettingItem, index: number) => {
          Column() {
            this.buildSettingItem(item)
            
            if (index < group.items.length - 1) {
              Row()
                .width('100%')
                .height(1)
                .backgroundColor(DesignSystem.getBorderColor(this.isLightMode))
                .margin({ left: 48 + DesignSystem.Spacing.md })
            }
          }
        })
      }
      .width('100%')
      .margin({
        left: DesignSystem.Spacing.lg,
        right: DesignSystem.Spacing.lg
      })
      .borderRadius(DesignSystem.BorderRadius.lg)
      .backgroundColor(DesignSystem.getSecondaryBackgroundColor(this.isLightMode))
      .border({
        width: 1,
        color: DesignSystem.getBorderColor(this.isLightMode)
      })
    }
    .width('100%')
    .margin({ bottom: DesignSystem.Spacing.md })
  }

  @Builder
  buildSettingItem(item: SettingItem) {
    Row() {
      Row() {
        Text(item.icon)
          .fontSize(DesignSystem.IconSize.md)
      }
      .width(32)
      .height(32)
      .borderRadius(DesignSystem.BorderRadius.md)
      .backgroundColor(DesignSystem.getHoverColor(this.isLightMode))
      .justifyContent(FlexAlign.Center)
      .margin({ right: DesignSystem.Spacing.md })

      Column() {
        Text(item.title)
          .fontSize(DesignSystem.Typography.size.base)
          .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
          .fontWeight(DesignSystem.Typography.weight.medium)

        if (item.subtitle) {
          Text(item.subtitle)
            .fontSize(DesignSystem.Typography.size.xs)
            .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
            .margin({ top: 2 })
        }
      }
      .alignItems(HorizontalAlign.Start)
      .layoutWeight(1)

      if (item.type === 'navigation') {
        Text('â€º')
          .fontSize(DesignSystem.Typography.size.xl)
          .fontColor(DesignSystem.getTertiaryTextColor(this.isLightMode))
      } else if (item.type === 'toggle') {
        Toggle({ type: ToggleType.Switch, isOn: item.value as boolean })
          .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
          .onChange((isOn: boolean) => {
            if (item.id === 'auto_update') {
              this.autoUpdate = isOn;
              this.toggleAutoUpdate();
            }
          })
      } else if (item.type === 'slider') {
        Row({ space: DesignSystem.Spacing.sm }) {
          Text(item.id === 'font_size' ? 'A-' : 'ç´§')
            .fontSize(DesignSystem.Typography.size.xs)
            .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
            .onClick(() => {
              if (item.id === 'font_size' && this.fontSize > 12) {
                this.updateFontSize(this.fontSize - 1);
              } else if (item.id === 'line_spacing' && this.lineSpacing > 1.2) {
                this.updateLineSpacing(this.lineSpacing - 0.1);
              }
            })

          Slider({
            value: item.id === 'font_size' ? this.fontSize : this.lineSpacing * 10,
            min: item.id === 'font_size' ? 12 : 12,
            max: item.id === 'font_size' ? 32 : 24,
            step: 1
          })
            .width(80)
            .blockColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .trackColor(DesignSystem.getBorderColor(this.isLightMode))
            .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .onChange((value: number) => {
              if (item.id === 'font_size') {
                this.updateFontSize(value);
              } else {
                this.updateLineSpacing(value / 10);
              }
            })

          Text(item.id === 'font_size' ? 'A+' : 'æ¾')
            .fontSize(DesignSystem.Typography.size.xs)
            .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
            .onClick(() => {
              if (item.id === 'font_size' && this.fontSize < 32) {
                this.updateFontSize(this.fontSize + 1);
              } else if (item.id === 'line_spacing' && this.lineSpacing < 2.4) {
                this.updateLineSpacing(this.lineSpacing + 0.1);
              }
            })
        }
      }
    }
    .width('100%')
    .padding(DesignSystem.Spacing.md)
    .onClick(() => {
      if (item.type === 'navigation' || item.type === 'action') {
        this.handleItemAction(item);
      }
    })
  }

  @Builder
  buildEmptySearchResult() {
    Column() {
      Text('ğŸ”')
        .fontSize(48)
        .margin({ bottom: DesignSystem.Spacing.md })

      Text('æœªæ‰¾åˆ°ç›¸å…³è®¾ç½®')
        .fontSize(DesignSystem.Typography.size.base)
        .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))

      Text('è¯·å°è¯•å…¶ä»–å…³é”®è¯')
        .fontSize(DesignSystem.Typography.size.sm)
        .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
        .margin({ top: DesignSystem.Spacing.xs })
    }
    .width('100%')
    .padding(DesignSystem.Spacing.xxl)
    .margin({ top: DesignSystem.Spacing.xxl })
  }

  @Builder
  buildClearCacheSheet() {
    Column() {
      Column() {
        Text('æ¸…é™¤ç¼“å­˜')
          .fontSize(DesignSystem.Typography.size.lg)
          .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
          .fontWeight(DesignSystem.Typography.weight.semibold)
          .margin({ bottom: DesignSystem.Spacing.md })

        Text(`ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¼“å­˜å—ï¼Ÿå½“å‰ç¼“å­˜å¤§å°: ${this.cacheSize}`)
          .fontSize(DesignSystem.Typography.size.sm)
          .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
          .textAlign(TextAlign.Center)
          .margin({ bottom: DesignSystem.Spacing.lg })

        Row({ space: DesignSystem.Spacing.md }) {
          Row() {
            Text('å–æ¶ˆ')
              .fontSize(DesignSystem.Typography.size.base)
              .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
              .fontWeight(DesignSystem.Typography.weight.medium)
          }
          .layoutWeight(1)
          .height(44)
          .borderRadius(DesignSystem.BorderRadius.md)
          .backgroundColor(DesignSystem.getSecondaryBackgroundColor(this.isLightMode))
          .justifyContent(FlexAlign.Center)
          .onClick(() => {
            this.showClearCacheConfirm = false;
          })

          Row() {
            if (this.isClearingCache) {
              LoadingProgress()
                .width(20)
                .height(20)
                .color(('sys.color.ohos_id_color_text_primary_contrary'))
            } else {
              Text('ç¡®å®š')
                .fontSize(DesignSystem.Typography.size.base)
                .fontColor($r('sys.color.ohos_id_color_text_primary_contrary'))
                .fontWeight(DesignSystem.Typography.weight.medium)
            }
          }
          .layoutWeight(1)
          .height(44)
          .borderRadius(DesignSystem.BorderRadius.md)
          .backgroundColor(DesignSystem.getPrimaryColor(this.isLightMode))
          .justifyContent(FlexAlign.Center)
          .onClick(() => {
            if (!this.isClearingCache) {
              this.clearCache();
            }
          })
        }
        .width('100%')
      }
      .width('100%')
      .padding(DesignSystem.Spacing.lg)
      .borderRadius(DesignSystem.BorderRadius.xl)
      .backgroundColor(DesignSystem.getSecondaryBackgroundColor(this.isLightMode))
    }
    .width('100%')
    .padding(DesignSystem.Spacing.lg)
  }

  @Builder
  buildAboutSheet() {
    Column() {
      Column() {
        Column() {
          Text('ğŸ“š')
            .fontSize(48)
            .margin({ bottom: DesignSystem.Spacing.md })

          Text('AstroRead')
            .fontSize(DesignSystem.Typography.size.xl)
            .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
            .fontWeight(DesignSystem.Typography.weight.bold)

          Text('ç‰ˆæœ¬ 1.0.0')
            .fontSize(DesignSystem.Typography.size.sm)
            .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
            .margin({ top: DesignSystem.Spacing.xs })
        }
        .width('100%')
        .padding(DesignSystem.Spacing.lg)

        Column() {
          Text('ä¸€æ¬¾ç®€æ´ä¼˜é›…çš„é˜…è¯»åº”ç”¨ï¼Œæ”¯æŒå¤šç§ä¹¦æºå¯¼å…¥ï¼Œæä¾›èˆ’é€‚çš„é˜…è¯»ä½“éªŒã€‚')
            .fontSize(DesignSystem.Typography.size.sm)
            .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
            .textAlign(TextAlign.Center)
            .lineHeight(22)
        }
        .width('100%')
        .padding({
          left: DesignSystem.Spacing.lg,
          right: DesignSystem.Spacing.lg,
          bottom: DesignSystem.Spacing.lg
        })

        Row() {
          Row() {
            Text('å…³é—­')
              .fontSize(DesignSystem.Typography.size.base)
              .fontColor($r('sys.color.ohos_id_color_text_primary_contrary'))
              .fontWeight(DesignSystem.Typography.weight.medium)
          }
          .width('100%')
          .height(44)
          .borderRadius(DesignSystem.BorderRadius.md)
          .backgroundColor(DesignSystem.getPrimaryColor(this.isLightMode))
          .justifyContent(FlexAlign.Center)
          .onClick(() => {
            this.showAboutSheet = false;
          })
        }
        .width('100%')
        .padding(DesignSystem.Spacing.lg)
      }
      .width('100%')
      .borderRadius(DesignSystem.BorderRadius.xl)
      .backgroundColor(DesignSystem.getSecondaryBackgroundColor(this.isLightMode))
    }
    .width('100%')
    .padding(DesignSystem.Spacing.lg)
  }

  @Builder
  buildFloatingNavSettingsSheet() {
    Column() {
      Column() {
        Text('æ‚¬æµ®å¯¼èˆªæ è®¾ç½®')
          .fontSize(DesignSystem.Typography.size.lg)
          .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
          .fontWeight(DesignSystem.Typography.weight.semibold)
          .margin({ bottom: DesignSystem.Spacing.lg })

        Scroll() {
          Column({ space: DesignSystem.Spacing.lg }) {
            this.buildFloatingNavToggleSection()
            this.buildFloatingNavPositionSection()
            this.buildFloatingNavSizeSection()
            this.buildFloatingNavStyleSection()
            this.buildFloatingNavBehaviorSection()
          }
          .width('100%')
          .padding({ bottom: DesignSystem.Spacing.xl })
        }
        .width('100%')
        .layoutWeight(1)
        .scrollBar(BarState.Auto)

        Row({ space: DesignSystem.Spacing.md }) {
          Row() {
            Text('é‡ç½®')
              .fontSize(DesignSystem.Typography.size.base)
              .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
              .fontWeight(DesignSystem.Typography.weight.medium)
          }
          .layoutWeight(1)
          .height(44)
          .borderRadius(DesignSystem.BorderRadius.md)
          .backgroundColor(DesignSystem.getSecondaryBackgroundColor(this.isLightMode))
          .justifyContent(FlexAlign.Center)
          .onClick(() => {
            floatingNavManager.resetToDefault();
            showToast({ message: 'å·²æ¢å¤é»˜è®¤è®¾ç½®' });
          })

          Row() {
            Text('å®Œæˆ')
              .fontSize(DesignSystem.Typography.size.base)
              .fontColor($r('sys.color.ohos_id_color_text_primary_contrary'))
              .fontWeight(DesignSystem.Typography.weight.medium)
          }
          .layoutWeight(1)
          .height(44)
          .borderRadius(DesignSystem.BorderRadius.md)
          .backgroundColor(DesignSystem.getPrimaryColor(this.isLightMode))
          .justifyContent(FlexAlign.Center)
          .onClick(() => {
            this.showFloatingNavSettings = false;
          })
        }
        .width('100%')
        .margin({ top: DesignSystem.Spacing.lg })
      }
      .width('100%')
      .height('100%')
      .padding(DesignSystem.Spacing.lg)
      .borderRadius(DesignSystem.BorderRadius.xl)
      .backgroundColor(DesignSystem.getSecondaryBackgroundColor(this.isLightMode))
    }
    .width('100%')
    .height('100%')
    .padding(DesignSystem.Spacing.lg)
  }

  @Builder
  buildFloatingNavToggleSection() {
    Column({ space: DesignSystem.Spacing.md }) {
      SectionHeader({ title: 'å¯ç”¨æ‚¬æµ®å¯¼èˆª' })

      Row() {
        Text('å¼€å¯æ‚¬æµ®å¯¼èˆªæ ')
          .fontSize(DesignSystem.Typography.size.base)
          .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
          .layoutWeight(1)

        Toggle({ type: ToggleType.Switch, isOn: this.floatingNavConfig.enabled })
          .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
          .onChange((isOn: boolean) => {
            floatingNavManager.setEnabled(isOn);
          })
      }
      .width('100%')
      .padding(DesignSystem.Spacing.md)
      .borderRadius(DesignSystem.BorderRadius.lg)
      .backgroundColor(DesignSystem.getPrimaryBackgroundColor(this.isLightMode))
    }
    .width('100%')
  }

  @Builder
  buildFloatingNavPositionSection() {
    Column({ space: DesignSystem.Spacing.md }) {
      SectionHeader({ title: 'ä½ç½®è®¾ç½®' })

      Column({ space: DesignSystem.Spacing.sm }) {
        ForEach([
          { id: 'bottom-left', label: 'å·¦ä¸‹è§’', icon: 'â†™ï¸' } as PositionOption,
          { id: 'bottom-center', label: 'åº•éƒ¨å±…ä¸­', icon: 'â¬‡ï¸' } as PositionOption,
          { id: 'bottom-right', label: 'å³ä¸‹è§’', icon: 'â†˜ï¸' } as PositionOption,
          { id: 'left', label: 'å·¦ä¾§å±…ä¸­', icon: 'â¬…ï¸' } as PositionOption,
          { id: 'center', label: 'å±å¹•ä¸­å¤®', icon: 'âºï¸' } as PositionOption,
          { id: 'right', label: 'å³ä¾§å±…ä¸­', icon: 'â¡ï¸' } as PositionOption
        ], (pos: PositionOption) => {
          Row() {
            Text(pos.icon)
              .fontSize(DesignSystem.IconSize.sm)
              .margin({ right: DesignSystem.Spacing.sm })

            Text(pos.label)
              .fontSize(DesignSystem.Typography.size.base)
              .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
              .layoutWeight(1)

            if (this.floatingNavConfig.position === pos.id) {
              Text('âœ“')
                .fontSize(DesignSystem.Typography.size.base)
                .fontColor(DesignSystem.getPrimaryColor(this.isLightMode))
            }
          }
          .width('100%')
          .padding(DesignSystem.Spacing.md)
          .borderRadius(DesignSystem.BorderRadius.md)
          .backgroundColor(this.floatingNavConfig.position === pos.id ?
            DesignSystem.getHoverColor(this.isLightMode) :
            DesignSystem.getPrimaryBackgroundColor(this.isLightMode))
          .onClick(() => {
            floatingNavManager.setPosition(pos.id as FloatingNavPosition);
          })
        })
      }
      .width('100%')
      .padding(DesignSystem.Spacing.md)
      .borderRadius(DesignSystem.BorderRadius.lg)
      .backgroundColor(DesignSystem.getPrimaryBackgroundColor(this.isLightMode))
    }
    .width('100%')
  }

  @Builder
  buildFloatingNavSizeSection() {
    Column({ space: DesignSystem.Spacing.md }) {
      SectionHeader({ title: 'å°ºå¯¸è®¾ç½®' })

      Column({ space: DesignSystem.Spacing.md }) {
        Column({ space: DesignSystem.Spacing.sm }) {
          Row() {
            Text('å®½åº¦')
              .fontSize(DesignSystem.Typography.size.base)
              .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
              .layoutWeight(1)

            Text(`${this.floatingNavConfig.width}px`)
              .fontSize(DesignSystem.Typography.size.sm)
              .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
          }
          .width('100%')

          Slider({
            value: this.floatingNavConfig.width,
            min: 200,
            max: 400,
            step: 10
          })
            .width('100%')
            .blockColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .trackColor(DesignSystem.getBorderColor(this.isLightMode))
            .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .onChange((value: number) => {
              floatingNavManager.setSize(value, this.floatingNavConfig.height);
            })
        }

        Column({ space: DesignSystem.Spacing.sm }) {
          Row() {
            Text('é«˜åº¦')
              .fontSize(DesignSystem.Typography.size.base)
              .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
              .layoutWeight(1)

            Text(`${this.floatingNavConfig.height}px`)
              .fontSize(DesignSystem.Typography.size.sm)
              .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
          }
          .width('100%')

          Slider({
            value: this.floatingNavConfig.height,
            min: 44,
            max: 80,
            step: 4
          })
            .width('100%')
            .blockColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .trackColor(DesignSystem.getBorderColor(this.isLightMode))
            .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .onChange((value: number) => {
              floatingNavManager.setSize(this.floatingNavConfig.width, value);
            })
        }

        Column({ space: DesignSystem.Spacing.sm }) {
          Row() {
            Text('åœ†è§’')
              .fontSize(DesignSystem.Typography.size.base)
              .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
              .layoutWeight(1)

            Text(`${this.floatingNavConfig.borderRadius}px`)
              .fontSize(DesignSystem.Typography.size.sm)
              .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
          }
          .width('100%')

          Slider({
            value: this.floatingNavConfig.borderRadius,
            min: 0,
            max: 40,
            step: 2
          })
            .width('100%')
            .blockColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .trackColor(DesignSystem.getBorderColor(this.isLightMode))
            .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .onChange((value: number) => {
              floatingNavManager.setBorderRadius(value);
            })
        }
      }
      .width('100%')
      .padding(DesignSystem.Spacing.md)
      .borderRadius(DesignSystem.BorderRadius.lg)
      .backgroundColor(DesignSystem.getPrimaryBackgroundColor(this.isLightMode))
    }
    .width('100%')
  }

  @Builder
  buildFloatingNavStyleSection() {
    Column({ space: DesignSystem.Spacing.md }) {
      SectionHeader({ title: 'æ ·å¼è®¾ç½®' })

      Column({ space: DesignSystem.Spacing.md }) {
        Column({ space: DesignSystem.Spacing.sm }) {
          Row() {
            Text('é€æ˜åº¦')
              .fontSize(DesignSystem.Typography.size.base)
              .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
              .layoutWeight(1)

            Text(`${Math.round(this.floatingNavConfig.opacity * 100)}%`)
              .fontSize(DesignSystem.Typography.size.sm)
              .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
          }
          .width('100%')

          Slider({
            value: this.floatingNavConfig.opacity * 100,
            min: 30,
            max: 100,
            step: 5
          })
            .width('100%')
            .blockColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .trackColor(DesignSystem.getBorderColor(this.isLightMode))
            .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .onChange((value: number) => {
              floatingNavManager.setOpacity(value / 100);
            })
        }

        Column({ space: DesignSystem.Spacing.sm }) {
          Row() {
            Text('èƒŒæ™¯é€æ˜åº¦')
              .fontSize(DesignSystem.Typography.size.base)
              .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
              .layoutWeight(1)

            Text(`${Math.round(this.floatingNavConfig.backgroundOpacity * 100)}%`)
              .fontSize(DesignSystem.Typography.size.sm)
              .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
          }
          .width('100%')

          Slider({
            value: this.floatingNavConfig.backgroundOpacity * 100,
            min: 30,
            max: 100,
            step: 5
          })
            .width('100%')
            .blockColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .trackColor(DesignSystem.getBorderColor(this.isLightMode))
            .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .onChange((value: number) => {
              floatingNavManager.setBackgroundOpacity(value / 100);
            })
        }

        Row() {
          Text('æ¯›ç»ç’ƒæ•ˆæœ')
            .fontSize(DesignSystem.Typography.size.base)
            .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
            .layoutWeight(1)

          Toggle({ type: ToggleType.Switch, isOn: this.floatingNavConfig.blurEnabled })
            .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .onChange((isOn: boolean) => {
              floatingNavManager.setBlurEnabled(isOn);
            })
        }
        .width('100%')
      }
      .width('100%')
      .padding(DesignSystem.Spacing.md)
      .borderRadius(DesignSystem.BorderRadius.lg)
      .backgroundColor(DesignSystem.getPrimaryBackgroundColor(this.isLightMode))
    }
    .width('100%')
  }

  @Builder
  buildFloatingNavBehaviorSection() {
    Column({ space: DesignSystem.Spacing.md }) {
      SectionHeader({ title: 'è¡Œä¸ºè®¾ç½®' })

      Column({ space: DesignSystem.Spacing.md }) {
        Row() {
          Text('è‡ªåŠ¨éšè—')
            .fontSize(DesignSystem.Typography.size.base)
            .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
            .layoutWeight(1)

          Toggle({ type: ToggleType.Switch, isOn: this.floatingNavConfig.autoHide })
            .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .onChange((isOn: boolean) => {
              floatingNavManager.setAutoHide(isOn);
            })
        }
        .width('100%')

        if (this.floatingNavConfig.autoHide) {
          Column({ space: DesignSystem.Spacing.sm }) {
            Row() {
              Text('éšè—å»¶è¿Ÿ')
                .fontSize(DesignSystem.Typography.size.base)
                .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
                .layoutWeight(1)

              Text(`${Math.round(this.floatingNavConfig.autoHideDelay / 1000)}ç§’`)
                .fontSize(DesignSystem.Typography.size.sm)
                .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
            }
            .width('100%')

            Slider({
              value: this.floatingNavConfig.autoHideDelay / 1000,
              min: 1,
              max: 10,
              step: 0.5
            })
              .width('100%')
              .blockColor(DesignSystem.getPrimaryColor(this.isLightMode))
              .trackColor(DesignSystem.getBorderColor(this.isLightMode))
              .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
              .onChange((value: number) => {
                floatingNavManager.setAutoHideDelay(value * 1000);
              })
          }
        }

        Row() {
          Text('åŠ¨ç”»æ•ˆæœ')
            .fontSize(DesignSystem.Typography.size.base)
            .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
            .layoutWeight(1)

          Toggle({ type: ToggleType.Switch, isOn: this.floatingNavConfig.animationEnabled })
            .selectedColor(DesignSystem.getPrimaryColor(this.isLightMode))
            .onChange((isOn: boolean) => {
              floatingNavManager.setAnimationEnabled(isOn);
            })
        }
        .width('100%')
      }
      .width('100%')
      .padding(DesignSystem.Spacing.md)
      .borderRadius(DesignSystem.BorderRadius.lg)
      .backgroundColor(DesignSystem.getPrimaryBackgroundColor(this.isLightMode))
    }
    .width('100%')
  }

  @Builder
  buildThemeModeSheet(): void {
    Column() {
      Column() {
        Text('ä¸»é¢˜æ¨¡å¼')
          .fontSize(DesignSystem.Typography.size.lg)
          .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
          .fontWeight(DesignSystem.Typography.weight.semibold)
          .margin({ bottom: DesignSystem.Spacing.lg })

        Column({ space: DesignSystem.Spacing.sm }) {
          ForEach(['æµ…è‰²æ¨¡å¼', 'æ·±è‰²æ¨¡å¼', 'è·Ÿéšç³»ç»Ÿ'], (mode: string, index: number) => {
            Row() {
              Text(mode)
                .fontSize(DesignSystem.Typography.size.base)
                .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
                .layoutWeight(1)

              if (this.themeModeIndex === index) {
                Text('âœ“')
                  .fontSize(DesignSystem.Typography.size.base)
                  .fontColor(DesignSystem.getPrimaryColor(this.isLightMode))
              }
            }
            .width('100%')
            .padding(DesignSystem.Spacing.md)
            .borderRadius(DesignSystem.BorderRadius.md)
            .backgroundColor(this.themeModeIndex === index 
              ? DesignSystem.getHoverColor(this.isLightMode) 
              : Color.Transparent)
            .onClick(() => {
              this.setThemeMode(index);
              this.showThemeModeSheet = false;
            })
          })
        }
        .width('100%')

        Button('å–æ¶ˆ')
          .width('100%')
          .margin({ top: DesignSystem.Spacing.lg })
          .backgroundColor(DesignSystem.getSecondaryBackgroundColor(this.isLightMode))
          .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
          .onClick(() => {
            this.showThemeModeSheet = false;
          })
      }
      .width('100%')
      .padding(DesignSystem.Spacing.lg)
      .borderRadius(DesignSystem.BorderRadius.lg)
      .backgroundColor(DesignSystem.getPrimaryBackgroundColor(this.isLightMode))
    }
    .width('100%')
    .padding({ bottom: this.safeAreaBottom })
  }

  @Builder
  buildReadBackgroundSheet(): void {
    Column() {
      Column() {
        Text('é˜…è¯»èƒŒæ™¯')
          .fontSize(DesignSystem.Typography.size.lg)
          .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
          .fontWeight(DesignSystem.Typography.weight.semibold)
          .margin({ bottom: DesignSystem.Spacing.lg })

        Text('é˜…è¯»èƒŒæ™¯è®¾ç½®åŠŸèƒ½å³å°†ä¸Šçº¿')
          .fontSize(DesignSystem.Typography.size.base)
          .fontColor(DesignSystem.getSecondaryTextColor(this.isLightMode))
          .margin({ bottom: DesignSystem.Spacing.lg })

        Button('çŸ¥é“äº†')
          .width('100%')
          .backgroundColor(DesignSystem.getPrimaryColor(this.isLightMode))
          .fontColor(('sys.color.ohos_id_color_text_primary_contrary'))
          .onClick(() => {
            this.showReadBackgroundSheet = false;
          })
      }
      .width('100%')
      .padding(DesignSystem.Spacing.lg)
      .borderRadius(DesignSystem.BorderRadius.lg)
      .backgroundColor(DesignSystem.getPrimaryBackgroundColor(this.isLightMode))
    }
    .width('100%')
    .padding({ bottom: this.safeAreaBottom })
  }

  @Builder
  buildFeedbackSheet(): void {
    Column() {
      Column() {
        Text('æ„è§åé¦ˆ')
          .fontSize(DesignSystem.Typography.size.lg)
          .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
          .fontWeight(DesignSystem.Typography.weight.semibold)
          .margin({ bottom: DesignSystem.Spacing.lg })

        TextArea({ placeholder: 'è¯·è¾“å…¥æ‚¨çš„æ„è§å’Œå»ºè®®...' })
          .width('100%')
          .height(120)
          .backgroundColor(DesignSystem.getSecondaryBackgroundColor(this.isLightMode))
          .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
          .placeholderColor(DesignSystem.getTertiaryTextColor(this.isLightMode))
          .margin({ bottom: DesignSystem.Spacing.md })

        Button('æäº¤åé¦ˆ')
          .width('100%')
          .backgroundColor(DesignSystem.getPrimaryColor(this.isLightMode))
          .fontColor(('sys.color.ohos_id_color_text_primary_contrary'))
          .onClick(() => {
            showToast({ message: 'æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼' });
            this.showFeedbackSheet = false;
          })

        Button('å–æ¶ˆ')
          .width('100%')
          .margin({ top: DesignSystem.Spacing.sm })
          .backgroundColor(DesignSystem.getSecondaryBackgroundColor(this.isLightMode))
          .fontColor(DesignSystem.getPrimaryTextColor(this.isLightMode))
          .onClick(() => {
            this.showFeedbackSheet = false;
          })
      }
      .width('100%')
      .padding(DesignSystem.Spacing.lg)
      .borderRadius(DesignSystem.BorderRadius.lg)
      .backgroundColor(DesignSystem.getPrimaryBackgroundColor(this.isLightMode))
    }
    .width('100%')
    .padding({ bottom: this.safeAreaBottom })
  }
}
